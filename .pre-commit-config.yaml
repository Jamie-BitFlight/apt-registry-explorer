# Pre-commit hooks configuration
# Install: uv run pre-commit install
# Run manually: uv run pre-commit run --all-files

default_install_hook_types: [pre-commit, commit-msg]
default_stages: [pre-commit]

repos:
  # ==========================================================================
  # Ruff - Fast Python linter and formatter
  # ==========================================================================
  - repo: https://github.com/astral-sh/ruff-pre-commit
    rev: v0.9.4
    hooks:
      # Run the formatter
      - id: ruff-format
        name: ruff-format
        args: [--config, pyproject.toml]
        types_or: [python, pyi]
        files: ^(packages/apt-registry-explorer/src|tests)/

      # Run the linter
      - id: ruff
        name: ruff-lint
        args: [--fix, --config, pyproject.toml]
        types_or: [python, pyi]
        files: ^(packages/apt-registry-explorer/src|tests)/

  # ==========================================================================
  # Mypy - Static type checker
  # ==========================================================================
  - repo: https://github.com/pre-commit/mirrors-mypy
    rev: v1.14.1
    hooks:
      - id: mypy
        name: mypy
        args:
          - --config-file=pyproject.toml
          - --show-error-codes
          - --pretty
        files: ^packages/apt-registry-explorer/src/
        additional_dependencies:
          - pydantic>=2.0.0
          - typer>=0.21.0
          - httpx>=0.27.0
          - textual>=0.40.0

  # ==========================================================================
  # Basedpyright - Enhanced Pyright type checker
  # ==========================================================================
  - repo: local
    hooks:
      - id: basedpyright
        name: basedpyright
        entry: uv run basedpyright
        language: system
        types: [python]
        files: ^packages/apt-registry-explorer/src/
        pass_filenames: false

  # ==========================================================================
  # Prettier - Format non-Python files (YAML, JSON, Markdown)
  # ==========================================================================
  - repo: https://github.com/pre-commit/mirrors-prettier
    rev: v4.0.0-alpha.8
    hooks:
      - id: prettier
        name: prettier
        types_or: [yaml, json, markdown]
        exclude: |
          (?x)^(
            uv\.lock|
            .*\.min\..*
          )$

  # ==========================================================================
  # Pytest - Run tests before commit
  # ==========================================================================
  - repo: local
    hooks:
      - id: pytest
        name: pytest
        entry: uv run pytest -x -q --no-cov -m "not integration"
        language: system
        pass_filenames: false
        always_run: true
        stages: [pre-commit]

  # ==========================================================================
  # General file checks
  # ==========================================================================
  - repo: https://github.com/pre-commit/pre-commit-hooks
    rev: v5.0.0
    hooks:
      - id: trailing-whitespace
        exclude: \.md$
      - id: end-of-file-fixer
      - id: check-yaml
        args: [--unsafe]
      - id: check-json
      - id: check-toml
      - id: check-added-large-files
        args: [--maxkb=1000]
      - id: check-merge-conflict
      - id: debug-statements
      - id: detect-private-key

  # ==========================================================================
  # Commit message validation
  # ==========================================================================
  - repo: https://github.com/commitizen-tools/commitizen
    rev: v4.1.0
    hooks:
      - id: commitizen
        name: commitizen
        stages: [commit-msg]

# CI configuration - skip slower hooks in CI environment
ci:
  autofix_commit_msg: "style: auto-fix by pre-commit hooks"
  autoupdate_commit_msg: "chore: update pre-commit hooks"
  skip:
    - pytest  # Tests run separately in CI
    - basedpyright  # Run in dedicated CI job
