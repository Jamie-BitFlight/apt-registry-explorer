name: Code Quality

on:
  push:
    branches: [ main, develop ]
  pull_request:
    branches: [ main, develop ]

permissions:
  contents: read
  pull-requests: write
  checks: write

jobs:
  quality:
    name: Code Quality Checks
    runs-on: ubuntu-latest
    
    steps:
    - uses: actions/checkout@v4
      with:
        fetch-depth: 0  # For hatch-vcs
    
    - name: Set up Python 3.11
      uses: actions/setup-python@v5
      with:
        python-version: "3.11"
    
    - name: Install uv
      uses: astral-sh/setup-uv@v5
      with:
        version: "latest"
    
    - name: Install dependencies
      run: |
        uv sync
    
    - name: Run ruff format check
      run: |
        uv run ruff format --check packages/apt-registry-explorer/src tests/
      continue-on-error: false
    
    - name: Run ruff linter with annotations
      run: |
        uv run ruff check packages/apt-registry-explorer/src tests/ --output-format=github
      continue-on-error: false
    
    - name: Run mypy type checker
      run: |
        uv run mypy packages/apt-registry-explorer/src --show-error-codes --pretty
      continue-on-error: false
    
    - name: Run basedpyright type checker
      run: |
        uv run basedpyright packages/apt-registry-explorer/src
      continue-on-error: false
    
    - name: Quality checks summary
      if: success()
      run: |
        echo "âœ… All code quality checks passed!"
        echo "- ruff format: Code formatting is correct"
        echo "- ruff check: No linting issues found"
        echo "- mypy: Type checking passed"
        echo "- basedpyright: Strict type checking passed"
